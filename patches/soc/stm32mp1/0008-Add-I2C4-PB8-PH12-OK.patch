From a1ff34a4289e763b587863cb85e66fc5b807c5b3 Mon Sep 17 00:00:00 2001
From: turmary <turmary@126.com>
Date: Tue, 27 Aug 2019 10:14:24 +0800
Subject: [PATCH 08/14] Add: I2C4 @(PB8, PH12) OK

---
 arch/arm/boot/dts/stm32mp157-pinctrl.dtsi | 34 +++++++++++++----------
 arch/arm/boot/dts/stm32mp157a-dk1.dts     | 11 ++++++++
 2 files changed, 30 insertions(+), 15 deletions(-)

diff --git a/arch/arm/boot/dts/stm32mp157-pinctrl.dtsi b/arch/arm/boot/dts/stm32mp157-pinctrl.dtsi
index 2872ad7c28b5..55d94671fc8f 100644
--- a/arch/arm/boot/dts/stm32mp157-pinctrl.dtsi
+++ b/arch/arm/boot/dts/stm32mp157-pinctrl.dtsi
@@ -639,6 +639,25 @@
 				};
 			};
 
+			i2c4_pins_a: i2c4-0 {
+				pins {
+					pinmux = <STM32_PINMUX('B',  8, AF6)>, /* I2C4_SCL */
+						 <STM32_PINMUX('H', 12, AF4)>; /* I2C4_SDA */
+					bias-disable;
+					drive-open-drain;
+					slew-rate = <0>;
+				};
+			};
+
+			i2c4_pins_sleep_a: i2c4-1 {
+				pins {
+					pinmux = <STM32_PINMUX('B',  8, ANALOG)>, /* I2C4_SCL */
+						 <STM32_PINMUX('H', 12, ANALOG)>; /* I2C4_SDA */
+				};
+			};
+
+
+
 			i2c5_pins_a: i2c5-0 {
 				pins {
 					pinmux = <STM32_PINMUX('A', 11, AF4)>, /* I2C5_SCL */
@@ -1633,21 +1652,6 @@
 				};
 			};
 
-			i2c4_pins_a: i2c4-0 {
-				pins {
-					pinmux = <STM32_PINMUX('Z', 5, AF6)>; /* I2C4_SDA */
-					bias-disable;
-					drive-open-drain;
-					slew-rate = <0>;
-				};
-			};
-
-			i2c4_pins_sleep_a: i2c4-1 {
-				pins {
-					pinmux = <STM32_PINMUX('Z', 5, ANALOG)>; /* I2C4_SDA */
-				};
-			};
-
 			spi1_pins_a: spi1-0 {
 				pins1 {
 					pinmux = <STM32_PINMUX('Z', 0, AF5)>, /* SPI1_SCK */
diff --git a/arch/arm/boot/dts/stm32mp157a-dk1.dts b/arch/arm/boot/dts/stm32mp157a-dk1.dts
index 3f0ae053e8e0..e6e4777e5fc9 100644
--- a/arch/arm/boot/dts/stm32mp157a-dk1.dts
+++ b/arch/arm/boot/dts/stm32mp157a-dk1.dts
@@ -484,6 +484,17 @@
 	};
 };
 
+&i2c4 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&i2c4_pins_a>;
+	pinctrl-1 = <&i2c4_pins_sleep_a>;
+	i2c-scl-rising-time-ns = <185>;
+	i2c-scl-falling-time-ns = <20>;
+	status = "okay";
+	/delete-property/dmas;
+	/delete-property/dma-names;
+};
+
 /*
 &i2s2 {
 	clocks = <&rcc SPI2>, <&rcc SPI2_K>, <&rcc PLL3_Q>, <&rcc PLL3_R>;
-- 
2.18.0

